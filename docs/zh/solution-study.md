# 知识点


## 概要

RethinkDB 是一个与 MongoDB 对标的开源数据库。  

当您的应用程序可以从数据的实时提取中受益时，RethinkDB 是一个不错的选择。

查询-响应数据库访问模型在Web上运行良好，因为它直接映射到HTTP的请求-响应。但是，现代应用程序需要直接将数据直接实时发送到客户端。用例包括：

- 协作式Web和移动应用程序
- 流分析应用
- 多人游戏
- 实时市场
- 连接的设备

例如，当用户更改协作设计应用程序中按钮的位置时，服务器必须通知同时在同一项目上工作的其他用户。  

Web浏览器通过WebSocket和长期存在的HTTP连接来支持这些用例，但是要使数据库系统适应实时需求仍然会带来巨大的工程挑战。  

RethinkDB是第一个开放源代码，可扩展的数据库，专门设计用于将数据实时推送到应用程序。它大大减少了构建可伸缩实时应用程序所需的时间和精力。 

## 用户权限

RethinkDB 中的用户类似于大多数其他数据库系统中的用户。  

### 用户管理

#### 管理密码

默认管理员用户名为 `admin`，密码为空。通过服务端命令行，可以很方便的设置管理员密码：

```
rethinkdb --initial-password yourpassword
```

#### 创建用户

RethinkDB 不仅仅支持管理员用户，用户也可以增加更多的用户，所有的用户信息存储在 **users** [系统表](https://rethinkdb.com/docs/system-tables/)中。  

由于系统表只有 admin 用户采用访问权限，因此必须以 admin 用户连接到数据库之后，再参考下面命令创建新用户：  

```
# 创建带密码的用户
r.db('rethinkdb').table('users').insert({id: 'username', password: 'secret'})
```

#### 重置密码

```
# 重置为新密码
r.db('rethinkdb').table('users').get('username').update({password: newpassword})

# 重置为空密码
r.db('rethinkdb').table('users').get('username').update({password: false})
```

### 权限

权限存储在 permissions 系统表中。虽然您可以通过修改该表中的文档来更改权限，但使用grant命令要方便得多。

默认支持四种权限：

* read
* write
* config
* connect

有三种权限范围：  

* 表（仅影响表）
* 数据库（影响数据库和其中的表）
* 全局（影响所有数据库和其中的表）


## 访问控制

RethinkDB 默认启动不支持远程访问，修改它的配置文件：*/etc/rethinkdb/instances.d/instance.conf*  中的 bind 项。  
```
bind=0.0.0.0
```


## 数据

### 系统表

RethinkDB 维护特殊的[系统表](https://rethinkdb.com/docs/system-tables/)，其中包含有关服务器、数据库、单个表和集群问题的配置和状态信息。

### 备份

运行 `rethinkdb dump` 备份数据

### 导入

运行 `rethinkdb import` 导入数据

## 集群


## 要点

#### RethinkDB是否支持SQL？

不支持。但是，RethinkDB的查询语言几乎可以执行SQL所能做的一切，包括表联接和聚合功能，并且功能强大，表达力强且易于学习。  

ReQL还可以完成SQL无法完成的许多工作，包括将查询与JavaScript表达式和map-reduce混合使用。

#### RethinkDB如何处理写入持久性？

RethinkDB开箱即用，具有严格的写入持久性，并且在这方面与传统数据库系统相同。默认情况下，只有将写入安全地提交到磁盘后，才会确认写入。

#### 什么时候RethinkDB不是一个好的选择？

如果您需要全面的ACID支持或强大的架构实施，那么RethinkDB并不是好的选择-在这种情况下，最好使用MySQL或PostgreSQL等关系数据库。  
如果您要进行深入的计算密集型分析，那么最好使用诸如Hadoop之类的系统或诸如Vertica之类的面向列的存储。  
在某些情况下，RethinkDB会权衡写可用性以支持数据一致性。如果高写入可用性至关重要，并且您不介意处理冲突，那么使用Riak这样的Dynamo风格的系统可能会更好。  

#### RethinkDB 控制台是否可以查看系统表？

未知，待研究

#### 调用表时出现“ ReqlResourceLimitError：数组大小超过限制100000”？

不带索引的订购要求服务器将整个序列加载到一个数组中，默认情况下，该序列限制为100,000个文档。  
您可以使用该arrayLimit选项运行以临时提高此限制。但是，更有效的选择是使用索引。

#### 插入速度很慢。怎样才能加快速度？

RethinkDB使用安全的默认配置进行写确认。在服务器向客户端确认之前，每次写入都会提交到磁盘。如果您正在运行一个循环将文档  
插入RethinkDB的线程，则每个插入操作必须等待服务器确认，然后才能进行下一个操作。这会大大降低整体吞吐量。
此行为类似于任何其他安全数据库系统。您可以采取以下一些步骤来提高RethinkDB中的插入性能。这些准则中的大多数也将适用于其他数据库系统。
增加并发性。而不是让单个线程在循环中插入数据，而是创建具有多个连接的多个线程。这将允许插入查询的并行化，而无需花费大部分时间等待磁盘确认。
批量写入。而不是在循环中进行单次写入，而是将组写入在一起。这可以导致吞吐量的显着提高。
考虑使用软耐用性模式。在软持久性模式下，RethinkDB将在接收到写入之后但在将写入提交到磁盘之前立即确认写入。服务器将使用主内存来吸收写操作，并将新数据在后台刷新到磁盘。